"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var http_1 = require("@angular/http");
var http_2 = require("@angular/http");
var _1 = require("rxjs/");
var AppointmentService = (function () {
    function AppointmentService(http) {
        this.http = http;
        this.url = "https://tools.brandinstitute.com/wsbi/bimobile.asmx/";
        this.urlGetAppointments = "getAppointments";
        this.urlSetGeoLocation = "addGeoLocation";
        this._appointments = new _1.BehaviorSubject([]);
        this.latitude = 25.773338;
        this.longitude = -80.190072;
        this.monthNames = ["Jan", "Febr", "Mar", "Apr", "May", "Jun",
            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
        ];
        this._appointments = new _1.BehaviorSubject([]);
        this.appointments = this._appointments.asObservable();
    }
    AppointmentService.prototype.getAppointments = function () {
        var _this = this;
        var headers = new http_1.Headers({ 'content-type': 'application/x-www-form-urlencoded' });
        var body = new http_2.URLSearchParams();
        body.set('phoneId', localStorage.getItem('phoneNumber'));
        body.set('phoneIdType', "1");
        body.set('selDate', "10/16/2017");
        return this.http.post(this.url + this.urlGetAppointments, body.toString(), { headers: headers }).map(function (res) {
            var data = res.json();
            res.json().map(function (obj) {
                var dateTime = new Date(obj.AppDate);
                obj.AppDate = dateTime.getDate().toString() + ',' + _this.monthNames[dateTime.getMonth()].toString() + '-' +
                    +((dateTime.getHours() + 24 - 2) % 24).toString() + ':'
                    + dateTime.getMinutes().toString() + ((dateTime.getHours() >= 12) ? " PM" : " AM").toString();
            });
            return data;
        });
    };
    AppointmentService.prototype.getAppointmentLocation = function (appointmentAddress) {
        return this.http.get("http://maps.googleapis.com/maps/api/geocode/json?address=" + appointmentAddress).map(function (res) { return res.json(); });
    };
    AppointmentService.prototype.setGeoLocation = function (location, appointment) {
        var dateTime = new Date();
        var dateahora = dateTime.getFullYear().toString() + '-' + dateTime.getMonth().toString() + '-' + dateTime.getDate().toString() + ' ' +
            +dateTime.getHours().toString() + ':' + dateTime.getMinutes().toString() + ':' + dateTime.getSeconds().toString();
        var headers = new http_1.Headers();
        headers.append('Content-Type', 'application/x-www-form-urlencoded');
        var body = new http_2.URLSearchParams();
        body.set('phoneId', localStorage.getItem('phoneNumber'));
        body.set('phoneIdType', "1");
        body.set('geoDate', dateahora);
        body.set('appId', appointment.AppId.toString());
        body.set('geoLatitude', location.latitude.toString());
        body.set('geoLongitude', location.longitude.toString());
        return this.http.post(this.url + 'addGeoLocation', body.toString(), { headers: headers }).map(function (res) { return res.json(); });
    };
    AppointmentService.prototype.saveExpense = function (appointment, imageBase64, recType, recTotal) {
        var headers = new http_1.Headers({ 'content-type': 'application/x-www-form-urlencoded' });
        var body = new http_2.URLSearchParams();
        body.set('phoneId', localStorage.getItem('phoneNumber'));
        body.set('phoneIdType', "1");
        body.set('appId', appointment.AppId.toString());
        // body.set('recType', recType);  use when real values in number come from dropdown
        body.set('recType', '1');
        body.set('recTotal', '18');
        body.set('imgType', 'base64');
        body.set('img', imageBase64);
        return this.http.post(this.url + 'addAppReceiptString', body.toString(), { headers: headers }).map(function (res) { return res.json(); });
    };
    AppointmentService.prototype.getExpensesByAppointmentId = function (appid) {
        var headers = new http_1.Headers({ 'content-type': 'application/x-www-form-urlencoded' });
        var body = new http_2.URLSearchParams();
        body.set('phoneId', localStorage.getItem('phoneNumber'));
        body.set('phoneIdType', "1");
        body.set('appid', appid);
        return this.http.post(this.url + 'getExpensesByAppointmentId', body.toString(), { headers: headers }).map(function (res) {
            res.json();
        });
    };
    AppointmentService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [http_1.Http])
    ], AppointmentService);
    return AppointmentService;
}());
exports.AppointmentService = AppointmentService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwb2ludG1lbnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImFwcG9pbnRtZW50LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMEM7QUFDMUMsc0NBQXdEO0FBQ3hELHNDQUErQztBQUMvQywwQkFBb0Q7QUFPcEQ7SUFpQkksNEJBQW9CLElBQVU7UUFBVixTQUFJLEdBQUosSUFBSSxDQUFNO1FBaEJ0QixRQUFHLEdBQUcsc0RBQXNELENBQUE7UUFDNUQsdUJBQWtCLEdBQUcsaUJBQWlCLENBQUE7UUFDdEMsc0JBQWlCLEdBQUcsZ0JBQWdCLENBQUE7UUFJcEMsa0JBQWEsR0FBbUMsSUFBSSxrQkFBZSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBSXhFLGFBQVEsR0FBRyxTQUFTLENBQUM7UUFDckIsY0FBUyxHQUFHLENBQUMsU0FBUyxDQUFDO1FBQ3ZCLGVBQVUsR0FBRyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSztZQUMzRCxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUs7U0FDM0MsQ0FBQztRQUdFLElBQUksQ0FBQyxhQUFhLEdBQW1DLElBQUksa0JBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM3RSxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDMUQsQ0FBQztJQUVELDRDQUFlLEdBQWY7UUFBQSxpQkFpQkM7UUFoQkcsSUFBSSxPQUFPLEdBQUcsSUFBSSxjQUFPLENBQUMsRUFBRSxjQUFjLEVBQUUsbUNBQW1DLEVBQUUsQ0FBQyxDQUFDO1FBQ25GLElBQUksSUFBSSxHQUFHLElBQUksc0JBQWUsRUFBRSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUVsQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUEsR0FBRztZQUNwRyxJQUFJLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDdEIsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFDLEdBQVE7Z0JBQ3BCLElBQUksUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDckMsR0FBRyxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsR0FBRyxHQUFHLEtBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFLEdBQUcsR0FBRztvQkFDckcsQ0FBRSxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsR0FBRyxHQUFHO3NCQUN0RCxRQUFRLENBQUMsVUFBVSxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsR0FBRyxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDdEcsQ0FBQyxDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNELG1EQUFzQixHQUF0QixVQUF1QixrQkFBa0I7UUFDckMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLDJEQUEyRCxHQUFHLGtCQUFrQixDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFWLENBQVUsQ0FBQyxDQUFDO0lBQ2xJLENBQUM7SUFFRCwyQ0FBYyxHQUFkLFVBQWUsUUFBYSxFQUFFLFdBQXdCO1FBQ2xELElBQUksUUFBUSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDMUIsSUFBSSxTQUFTLEdBQUcsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsRUFBRSxHQUFHLEdBQUcsR0FBRyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsR0FBRyxHQUFHLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLEVBQUUsR0FBRyxHQUFHO1lBQ2hJLENBQUUsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsRUFBRSxHQUFHLEdBQUcsR0FBRyxRQUFRLENBQUMsVUFBVSxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsR0FBRyxHQUFHLFFBQVEsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN2SCxJQUFNLE9BQU8sR0FBRyxJQUFJLGNBQU8sRUFBRSxDQUFDO1FBQzlCLE9BQU8sQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLG1DQUFtQyxDQUFDLENBQUM7UUFDcEUsSUFBTSxJQUFJLEdBQUcsSUFBSSxzQkFBZSxFQUFFLENBQUM7UUFDbkMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQy9CLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUNoRCxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsUUFBUSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBRXhELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLGdCQUFnQixFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBVixDQUFVLENBQUMsQ0FBQztJQUNySCxDQUFDO0lBRUQsd0NBQVcsR0FBWCxVQUFZLFdBQXdCLEVBQUUsV0FBZ0IsRUFBRSxPQUFlLEVBQUUsUUFBZ0I7UUFDckYsSUFBSSxPQUFPLEdBQUcsSUFBSSxjQUFPLENBQUMsRUFBRSxjQUFjLEVBQUUsbUNBQW1DLEVBQUUsQ0FBQyxDQUFDO1FBQ25GLElBQU0sSUFBSSxHQUFHLElBQUksc0JBQWUsRUFBRSxDQUFDO1FBQ25DLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDaEQsbUZBQW1GO1FBQ25GLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzdCLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLHFCQUFxQixFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBVixDQUFVLENBQUMsQ0FBQztJQUMxSCxDQUFDO0lBRUQsdURBQTBCLEdBQTFCLFVBQTJCLEtBQWE7UUFDcEMsSUFBSSxPQUFPLEdBQUcsSUFBSSxjQUFPLENBQUMsRUFBRSxjQUFjLEVBQUUsbUNBQW1DLEVBQUUsQ0FBQyxDQUFDO1FBQ25GLElBQUksSUFBSSxHQUFHLElBQUksc0JBQWUsRUFBRSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN6QixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyw0QkFBNEIsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQSxHQUFHO1lBQ3pHLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNmLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQXBGUSxrQkFBa0I7UUFEOUIsaUJBQVUsRUFBRTt5Q0FrQmlCLFdBQUk7T0FqQnJCLGtCQUFrQixDQXFGOUI7SUFBRCx5QkFBQztDQUFBLEFBckZELElBcUZDO0FBckZZLGdEQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiXG5pbXBvcnQgeyBIdHRwLCBSZXNwb25zZSwgSGVhZGVycyB9IGZyb20gXCJAYW5ndWxhci9odHRwXCI7XG5pbXBvcnQgeyBVUkxTZWFyY2hQYXJhbXMgfSBmcm9tIFwiQGFuZ3VsYXIvaHR0cFwiXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzLyc7XG5pbXBvcnQgeyBBcHBvaW50bWVudCB9IGZyb20gXCIuL2FwcG9pbnRtZW50Lm1vZGVsXCI7XG5cbmltcG9ydCAqIGFzIGFwcGxpY2F0aW9uIGZyb20gJ2FwcGxpY2F0aW9uJ1xuXG5kZWNsYXJlIGxldCBhbmRyb2lkOiBhbnlcbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBcHBvaW50bWVudFNlcnZpY2Uge1xuICAgIHByaXZhdGUgdXJsID0gXCJodHRwczovL3Rvb2xzLmJyYW5kaW5zdGl0dXRlLmNvbS93c2JpL2JpbW9iaWxlLmFzbXgvXCJcbiAgICBwcml2YXRlIHVybEdldEFwcG9pbnRtZW50cyA9IFwiZ2V0QXBwb2ludG1lbnRzXCJcbiAgICBwcml2YXRlIHVybFNldEdlb0xvY2F0aW9uID0gXCJhZGRHZW9Mb2NhdGlvblwiXG4gICAgcHJpdmF0ZSBwaG9uZU51bWJlcjogT2JzZXJ2YWJsZTxhbnk+O1xuXG4gICAgcHVibGljIGFwcG9pbnRtZW50czogT2JzZXJ2YWJsZTxBcHBvaW50bWVudFtdPjtcbiAgICBwcml2YXRlIF9hcHBvaW50bWVudHMgPSA8QmVoYXZpb3JTdWJqZWN0PEFwcG9pbnRtZW50W10+Pm5ldyBCZWhhdmlvclN1YmplY3QoW10pO1xuICAgIHByaXZhdGUgZGF0YVN0b3JlOiB7XG4gICAgICAgIGFwcG9pbnRtZW50czogQXBwb2ludG1lbnRbXVxuICAgIH07XG4gICAgcHJpdmF0ZSBsYXRpdHVkZSA9IDI1Ljc3MzMzODtcbiAgICBwcml2YXRlIGxvbmdpdHVkZSA9IC04MC4xOTAwNzI7XG4gICAgcHJpdmF0ZSBtb250aE5hbWVzID0gW1wiSmFuXCIsIFwiRmViclwiLCBcIk1hclwiLCBcIkFwclwiLCBcIk1heVwiLCBcIkp1blwiLFxuICAgICAgICBcIkp1bFwiLCBcIkF1Z1wiLCBcIlNlcFwiLCBcIk9jdFwiLCBcIk5vdlwiLCBcIkRlY1wiXG4gICAgXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cCkge1xuICAgICAgICB0aGlzLl9hcHBvaW50bWVudHMgPSA8QmVoYXZpb3JTdWJqZWN0PEFwcG9pbnRtZW50W10+Pm5ldyBCZWhhdmlvclN1YmplY3QoW10pO1xuICAgICAgICB0aGlzLmFwcG9pbnRtZW50cyA9IHRoaXMuX2FwcG9pbnRtZW50cy5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBnZXRBcHBvaW50bWVudHMoKTogT2JzZXJ2YWJsZTxBcnJheTxBcHBvaW50bWVudD4+IHtcbiAgICAgICAgbGV0IGhlYWRlcnMgPSBuZXcgSGVhZGVycyh7ICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyB9KTtcbiAgICAgICAgbGV0IGJvZHkgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgICAgIGJvZHkuc2V0KCdwaG9uZUlkJywgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Bob25lTnVtYmVyJykpO1xuICAgICAgICBib2R5LnNldCgncGhvbmVJZFR5cGUnLCBcIjFcIik7XG4gICAgICAgIGJvZHkuc2V0KCdzZWxEYXRlJywgXCIxMC8xNi8yMDE3XCIpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh0aGlzLnVybCArIHRoaXMudXJsR2V0QXBwb2ludG1lbnRzLCBib2R5LnRvU3RyaW5nKCksIHsgaGVhZGVyczogaGVhZGVycyB9KS5tYXAocmVzID0+IHtcbiAgICAgICAgICAgIGxldCBkYXRhID0gcmVzLmpzb24oKTtcbiAgICAgICAgICAgIHJlcy5qc29uKCkubWFwKChvYmo6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBkYXRlVGltZSA9IG5ldyBEYXRlKG9iai5BcHBEYXRlKTtcbiAgICAgICAgICAgICAgICBvYmouQXBwRGF0ZSA9IGRhdGVUaW1lLmdldERhdGUoKS50b1N0cmluZygpICsgJywnICsgdGhpcy5tb250aE5hbWVzW2RhdGVUaW1lLmdldE1vbnRoKCldLnRvU3RyaW5nKCkgKyAnLScgK1xuICAgICAgICAgICAgICAgICAgICArICgoZGF0ZVRpbWUuZ2V0SG91cnMoKSArIDI0IC0gMikgJSAyNCkudG9TdHJpbmcoKSArICc6J1xuICAgICAgICAgICAgICAgICAgICArIGRhdGVUaW1lLmdldE1pbnV0ZXMoKS50b1N0cmluZygpICsgKChkYXRlVGltZS5nZXRIb3VycygpID49IDEyKSA/IFwiIFBNXCIgOiBcIiBBTVwiKS50b1N0cmluZygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldEFwcG9pbnRtZW50TG9jYXRpb24oYXBwb2ludG1lbnRBZGRyZXNzKTogT2JzZXJ2YWJsZTxBcnJheTxBcHBvaW50bWVudD4+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoXCJodHRwOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24/YWRkcmVzcz1cIiArIGFwcG9pbnRtZW50QWRkcmVzcykubWFwKHJlcyA9PiByZXMuanNvbigpKTtcbiAgICB9XG5cbiAgICBzZXRHZW9Mb2NhdGlvbihsb2NhdGlvbjogYW55LCBhcHBvaW50bWVudDogQXBwb2ludG1lbnQpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBsZXQgZGF0ZVRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBsZXQgZGF0ZWFob3JhID0gZGF0ZVRpbWUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpICsgJy0nICsgZGF0ZVRpbWUuZ2V0TW9udGgoKS50b1N0cmluZygpICsgJy0nICsgZGF0ZVRpbWUuZ2V0RGF0ZSgpLnRvU3RyaW5nKCkgKyAnICcgK1xuICAgICAgICAgICAgKyBkYXRlVGltZS5nZXRIb3VycygpLnRvU3RyaW5nKCkgKyAnOicgKyBkYXRlVGltZS5nZXRNaW51dGVzKCkudG9TdHJpbmcoKSArICc6JyArIGRhdGVUaW1lLmdldFNlY29uZHMoKS50b1N0cmluZygpO1xuICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcbiAgICAgICAgaGVhZGVycy5hcHBlbmQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTtcbiAgICAgICAgY29uc3QgYm9keSA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgICAgICAgYm9keS5zZXQoJ3Bob25lSWQnLCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGhvbmVOdW1iZXInKSk7XG4gICAgICAgIGJvZHkuc2V0KCdwaG9uZUlkVHlwZScsIFwiMVwiKTtcbiAgICAgICAgYm9keS5zZXQoJ2dlb0RhdGUnLCBkYXRlYWhvcmEpO1xuICAgICAgICBib2R5LnNldCgnYXBwSWQnLCBhcHBvaW50bWVudC5BcHBJZC50b1N0cmluZygpKTtcbiAgICAgICAgYm9keS5zZXQoJ2dlb0xhdGl0dWRlJywgbG9jYXRpb24ubGF0aXR1ZGUudG9TdHJpbmcoKSk7XG4gICAgICAgIGJvZHkuc2V0KCdnZW9Mb25naXR1ZGUnLCBsb2NhdGlvbi5sb25naXR1ZGUudG9TdHJpbmcoKSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHRoaXMudXJsICsgJ2FkZEdlb0xvY2F0aW9uJywgYm9keS50b1N0cmluZygpLCB7IGhlYWRlcnM6IGhlYWRlcnMgfSkubWFwKHJlcyA9PiByZXMuanNvbigpKTtcbiAgICB9XG5cbiAgICBzYXZlRXhwZW5zZShhcHBvaW50bWVudDogQXBwb2ludG1lbnQsIGltYWdlQmFzZTY0OiBhbnksIHJlY1R5cGU6IHN0cmluZywgcmVjVG90YWw6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGxldCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoeyAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgfSk7XG4gICAgICAgIGNvbnN0IGJvZHkgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgICAgIGJvZHkuc2V0KCdwaG9uZUlkJywgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Bob25lTnVtYmVyJykpO1xuICAgICAgICBib2R5LnNldCgncGhvbmVJZFR5cGUnLCBcIjFcIik7XG4gICAgICAgIGJvZHkuc2V0KCdhcHBJZCcsIGFwcG9pbnRtZW50LkFwcElkLnRvU3RyaW5nKCkpO1xuICAgICAgICAvLyBib2R5LnNldCgncmVjVHlwZScsIHJlY1R5cGUpOyAgdXNlIHdoZW4gcmVhbCB2YWx1ZXMgaW4gbnVtYmVyIGNvbWUgZnJvbSBkcm9wZG93blxuICAgICAgICBib2R5LnNldCgncmVjVHlwZScsICcxJyk7XG4gICAgICAgIGJvZHkuc2V0KCdyZWNUb3RhbCcsICcxOCcpO1xuICAgICAgICBib2R5LnNldCgnaW1nVHlwZScsICdiYXNlNjQnKTtcbiAgICAgICAgYm9keS5zZXQoJ2ltZycsIGltYWdlQmFzZTY0KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHRoaXMudXJsICsgJ2FkZEFwcFJlY2VpcHRTdHJpbmcnLCBib2R5LnRvU3RyaW5nKCksIHsgaGVhZGVyczogaGVhZGVycyB9KS5tYXAocmVzID0+IHJlcy5qc29uKCkpO1xuICAgIH1cblxuICAgIGdldEV4cGVuc2VzQnlBcHBvaW50bWVudElkKGFwcGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBsZXQgaGVhZGVycyA9IG5ldyBIZWFkZXJzKHsgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnIH0pO1xuICAgICAgICBsZXQgYm9keSA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgICAgICAgYm9keS5zZXQoJ3Bob25lSWQnLCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGhvbmVOdW1iZXInKSk7XG4gICAgICAgIGJvZHkuc2V0KCdwaG9uZUlkVHlwZScsIFwiMVwiKTtcbiAgICAgICAgYm9keS5zZXQoJ2FwcGlkJywgYXBwaWQpO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QodGhpcy51cmwgKyAnZ2V0RXhwZW5zZXNCeUFwcG9pbnRtZW50SWQnLCBib2R5LnRvU3RyaW5nKCksIHsgaGVhZGVyczogaGVhZGVycyB9KS5tYXAocmVzID0+IHtcbiAgICAgICAgICAgIHJlcy5qc29uKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuIl19